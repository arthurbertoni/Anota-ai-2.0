/**
 * src/middleware/auth.js
 * Middleware para autenticação de usuários
 */

/**
 * Middleware que verifica se o usuário está autenticado
 * @param {Request} req - Requisição Express
 * @param {Response} res - Resposta Express
 * @param {function} next - Próxima função a ser chamada
 */
function authMiddleware(req, res, next) {
  // Verificar se existe um usuário na sessão
  if (!req.session.usuario) {
    // Para requisições AJAX/API, retornar um erro no formato JSON
    if (req.xhr || req.path.startsWith('/api/')) {
      return res.status(401).json({
        erro: 'Não autorizado',
        message: 'É necessário estar autenticado para acessar este recurso'
      });
    }
    
    // Para requisições normais, redirecionar para a página de login
    return res.redirect('/login');
  }
  
  // Se o usuário estiver autenticado, passar para o próximo middleware/controller
  next();
}

module.exports = authMiddleware;
